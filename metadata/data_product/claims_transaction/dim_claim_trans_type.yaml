target:
  lakehouse: den_lhw_dpr_001_claims_transaction
  schema: claims_transaction
  table: dim_claim_trans_type
  load_strategy: type_two
  key_columns:
    - claim_trans_type_bus_key
  unknown_record: True
  identity: True
  identity_column_name: claim_trans_type_key

source:
  - name: wcpmttyp
    lakehouse: den_lhw_scu_001_claims_transaction_curated
    schema: iis_transaction
    table: wcpmttyp

query:
  - name: dim_claim_trans_type
    sql: |
      SELECT 
        'Payment' AS claim_trans_type,
        CASE 
          WHEN UPPER(TRIM(type)) IN ('D', 'L') THEN 'Loss'
          WHEN UPPER(TRIM(type)) IN ('E', 'X') THEN 'Expense'
          WHEN UPPER(TRIM(type)) IN ('I') THEN 'Indemnity'
          WHEN UPPER(TRIM(type)) IN ('M') THEN 'Medical'
        END AS claim_trans_subtype,
        concat(TRIM(typdesc),' (',type,typprefix,typcode,')') AS claim_trans_desc,
        concat(type,typprefix,typcode) AS claim_trans_type_bus_key
      FROM wcpmttyp
      WHERE dl_iscurrent = 1
      
      UNION 
      
      SELECT 
        'Reserve' AS claim_trans_type,
        'Loss' AS claim_trans_subtype,
        'Loss' AS claim_trans_desc,
        'RLL' AS claim_trans_type_bus_key
      
      UNION 
      
      SELECT 
        'Reserve' AS claim_trans_type,
        'Expense' AS claim_trans_subtype,
        'Expense' AS claim_trans_desc,
        'REE' AS claim_trans_type_bus_key
      
      UNION 
      
      SELECT 
        'Reserve' AS claim_trans_type,
        'Medical' AS claim_trans_subtype,
        'Medical' AS claim_trans_desc,
        'RMM' AS claim_trans_type_bus_key

    description: "This query creates a dimension table for claim transaction types, combining payment types from wcpmttyp with standard reserve types. It categorizes transactions into types (Payment/Reserve) and subtypes (Loss/Expense/Indemnity/Medical) with descriptive names and unique business keys."
    