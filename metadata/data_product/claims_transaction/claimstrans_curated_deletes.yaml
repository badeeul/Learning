target:
  lakehouse: den_lhw_scu_001_claims_transaction_curated
  schema: claims_transaction_curated
  table: claimstrans_curated
  load_strategy: merge
  key_columns:
    - claimstrans_id
    - cdc_deleted
  unknown_record: False
  identity: False

source:
  - name: claimstrans_cdc
    lakehouse: den_lhw_scu_001_claims_transaction_curated
    schema: iis_transaction_cdc
    table: dbo_claimstrans_ct

query:
  - name: cte_cdc_deletes
    sql: |
      select
          tc.claimstrans_id
        , tc.wcclaimid
        , tc.claimantid
        , tc.cvgid
        , tc.transtype
        , tc.enteredon
        , tc.enteredby
        , tc.effdate
        , tc.currentvalue
        , tc.priorvalue
        , tc.payment_id
                
        , tc.dl_rowhash
        , tc.dl_partitionkey
        , false as dl_iscurrent
        , tc.dl_recordstartdateutc
        , current_timestamp as dl_recordenddateutc
        , tc.dl_createddateutc
        , tc.dl_lastmodifiedutc
        , tc.dl_sourcefilepath
        , tc.dl_sourcefilename
        , tc.dl_eltid
        , tc.dl_runid
                
        , true as cdc_deleted

      from claimstrans_cdc tc

      where `__operation` = 1
    description: "Gathers DELETED records from claimstrans_cdc."
