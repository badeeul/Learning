target:
  lakehouse: den_lhw_dpr_001_claims_transaction
  schema: claims_transaction
  table: dim_claim_type
  load_strategy: type_two
  key_columns:
    - claim_type_cd_bus_key
  unknown_record: True
  identity: True
  identity_column_name: claim_type_key

source:
  - name: curated_lookups
    lakehouse: den_lhw_scu_001_claims_transaction_curated
    schema: iis_transaction
    table: lookups

query:
  - name: dim_claim_type
    sql: |
      SELECT DISTINCT 
          UPPER(TRIM(VALS)) AS claim_type_cd_bus_key,
          CASE 
            WHEN UPPER(TRIM(VALS)) = 'PD' THEN 'Property Damage' 
            ELSE TRIM(descrip) 
          END 
            AS claim_type_desc
      FROM 
          curated_lookups
      WHERE 
          UPPER(TRIM(keyfield)) = 'COVERAGECATEGORY'
          AND UPPER(TRIM(programid)) = 'WCCLAIM'
          AND dl_iscurrent = 1

      UNION

      SELECT DISTINCT 
          CASE 
            WHEN UPPER(TRIM(VALS)) = 'N' THEN 'MO' 
            WHEN UPPER(TRIM(VALS)) = 'Y' THEN 'LT' 
          END 
            AS claim_type_cd_bus_key,
          TRIM(descrip) AS claim_type_desc
      FROM 
          curated_lookups
      WHERE 
          UPPER(TRIM(keyfield)) = 'LTE'
          AND UPPER(TRIM(programid)) = '*'
          AND dl_iscurrent = 1

      UNION

      SELECT 
          'DB' AS claim_type_cd_bus_key,
          'Disability' AS claim_type_desc
    description: "This query creates a claim type dimension by combining coverage category, LTE, and a static disability record from the curated_lookups source table."
